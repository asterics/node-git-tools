!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["@asterics/git-tools"]=t():e["@asterics/git-tools"]=t()}(global,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,n){var r,o,u;o=[t,n(0),n(1),n(3)],void 0===(u="function"==typeof(r=function(e,t,n,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function u(e){let n=!1;return t.default.existsSync(e)&&(t.default.accessSync(e,t.default.constants.R_OK),n=t.default.statSync(e).isDirectory()),n}function i(e){let r=t.default.readdirSync(e);return!!(r=(r=r.map(t=>n.default.join(e,t))).filter(e=>u(e))).find(e=>/.git$/.test(e))}function c(e,n){let r=`${e}/${n}`;return{path:r,stat:t.default.statSync(r)}}function l(e){try{t.default.accessSync(e,t.default.constants.R_OK);let n=/.git$/,r=t.default.readdirSync(e).map(t=>c(e,t)).filter(e=>e.stat.isDirectory()&&n.test(e.path));return r.length>0}catch(e){return 0}}function f(e){return e?`--git-dir=${e}/.git --work-tree=${e}`:""}function s(){return!!(0,r.hasShellCommand)("git")||(console.log("ensureGitSubmodule() requires git (shell)."),!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.getReferenceInPath=function(e,r){if(!n.default.isAbsolute(e))return;let o,c=new RegExp(r+"$"),l=n.default.normalize(e),f=l.split(n.default.sep).length;for(let e=0;e<f&&!o;e++,l=n.default.join(l,".."))try{if(t.default.existsSync(l)){let e=t.default.readdirSync(l);e=(e=(e=e.map(e=>n.default.join(l,e))).filter(e=>u(e))).filter(e=>i(e)),o=e.find(e=>c.test(e))}}catch(e){o=!1}return o||""},e.gitLocalPath=function(e,r){let o,u=/^auto:/;if(u.test(r)){r=r.replace(u,"");let i=e,f=i.split("/").length,s=new RegExp("/"+r+"$");for(let e=0;e<f;e++){let e=t.default.readdirSync(i).map(e=>c(i,e)).filter(e=>e.stat.isDirectory()).filter(e=>s.test(e.path)).filter(e=>l(e.path));if(e.length>0){o=e[0].path;break}i=n.default.join(i,"..")}}else/^remote/.test(r)?o="":n.default.isAbsolute(r)&&(o=r);return o},e.ensureGitSubmodule=function({name:e,location:t,reference:n="",branch:o="master",fatality:u=!1},i=!1){if(!s())return;let c={submodule:`git submodule update --init ${n?`--reference ${n}`:""} ${t}`,checkout:`git ${f(t)} checkout ${o}`,sync:`git ${f(t)} pull --all`};(0,r.execute)({cmd:c.submodule,success:`submodule '${e}' cloned`,error:`failed cloning submodule '${e}'`,fatality:u,verbose:i}),(0,r.execute)({cmd:c.checkout,success:`submodule '${e}' checked out at '${o}'`,error:`failed checking out submodule '${e}' at '${o}'`,fatality:u,verbose:i}),(0,r.execute)({cmd:c.sync,success:`submodule '${e}' synchronized with remote origin`,error:`failed pulling '${e}' from remote origin`,fatality:u,verbose:i})},e.checkoutSubmodule=function({name:e,location:t,reference:n,branch:o="master",fatality:u=!1},i=!1){if(!s())return;let c={checkout:`git ${f(t)} checkout ${o}`};(0,r.execute)({cmd:c.checkout,success:`submodule '${e}' checked out ${e} at '${o}'`,error:`failed checking out '${e}' at '${o}'`,fatality:u,verbose:i})},t=o(t),n=o(n)})?r.apply(t,o):r)||(e.exports=u)},function(e,t,n){var r,o,u;o=[],void 0===(u="function"==typeof(r=function(){"use strict";global,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var r,o,u;o=[t,n(1),n(2),n(3)],void 0===(u="function"==typeof(r=function(e,t,n,r){function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n,r,o){let u="-".repeat(80),i="=".repeat(80);console.log(e),t&&(console.log(u),console.log("$",r,o.join(" ")),console.log(i),console.log(n),console.log(i))}Object.defineProperty(e,"__esModule",{value:!0}),e.execute=function({cmd:e="",success:t="success",error:n="error",env:u={},fatal:c=!1,verbose:l=!1}){let f=e.split(" ");if(""!==(e=f.shift())){const s=(0,r.spawnSync)(e,f,{shell:!0,encoding:"utf-8",env:o({},process.env,u)});0!==s.status?(i(n,l,s.stderr||s.stdout,e,f),c&&process.exit(1)):i(t,l,s.stdout||s.stderr,e,f)}},e.mkdirp=function e(...r){for(let o of r){if(!(0,n.isAbsolute)(o))continue;let r=(0,n.join)(o,"..");r===(0,n.join)("/")||(0,t.existsSync)(r)||e(r),(0,t.existsSync)(o)||(0,t.mkdirSync)(o)}},e.hasShellCommand=function(...e){let t=!0;for(let n of e){let{status:e}=(0,r.spawnSync)("which",[n],{encoding:"utf-8"});0!==e&&(t=!1)}return t}})?r.apply(t,o):r)||(e.exports=u)},function(e,t){e.exports=n(0)},function(e,t){e.exports=n(1)},function(e,t){e.exports=n(4)}])})?r.apply(t,o):r)||(e.exports=u)},function(e,t){e.exports=require("child_process")}])});
//# sourceMappingURL=index.node.js.map